<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Umbrella CRM - Claims & Property Solutions</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'umbrella-blue': '#3b82f6',
                        'umbrella-red': '#ef4444'
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background: #000000;
            color: #ffffff;
        }
        .dark-card {
            background: #1f2937;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
        }
        .input-field {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #374151;
            border-radius: 0.5rem;
            background: #374151;
            color: #ffffff;
        }
        .input-field::placeholder {
            color: #9ca3af;
        }
        .btn-primary {
            background: #3b82f6;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.2s;
            cursor: pointer;
        }
        .btn-primary:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }
        .btn-secondary {
            background: #6b7280;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.2s;
            cursor: pointer;
        }
        .btn-secondary:hover {
            background: #4b5563;
        }
        .page {
            display: none;
        }
        .page.active {
            display: block;
        }
        .nav-link {
            cursor: pointer;
            color: #d1d5db;
        }
        .nav-link:hover {
            background: #374151;
            color: #ffffff;
        }
        .nav-link.active {
            background: #3b82f6;
            color: #ffffff;
        }
        .login-container {
            display: block;
        }
        .crm-container {
            display: none;
        }
        .crm-container.active {
            display: flex;
        }
        .sidebar-bg {
            background: #111827;
        }
        .table-header {
            background: #374151;
            color: #ffffff;
        }
        .table-row {
            border-bottom: 1px solid #374151;
        }
        .table-row:hover {
            background: #374151;
        }
        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 2rem;
        }
        .logo-text {
            font-family: 'Arial', sans-serif;
            font-weight: bold;
            font-size: 2.5rem;
            letter-spacing: -0.025em;
        }
        .logo-text .um {
            color: #3b82f6;
        }
        .logo-text .brella {
            color: #ef4444;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
        }
        .modal-content {
            background: #1f2937;
            margin: 5% auto;
            padding: 2rem;
            border-radius: 0.75rem;
            width: 90%;
            max-width: 500px;
        }
        .profile-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #10b981;
            color: white;
            padding: 1rem;
            border-radius: 0.5rem;
            z-index: 1001;
            display: none;
        }
    </style>
</head>
<body class="bg-black">
    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <!-- Login Page -->
    <div id="loginPage" class="login-container min-h-screen bg-black flex items-center justify-center px-4">
        <div class="max-w-md w-full space-y-8">
            <!-- Logo and Title -->
            <div class="text-center">
                <div class="logo-container">
                    <img src="/logo-transparent.png" alt="Umbrella Claims & Property Solutions" class="h-24 mx-auto" />
                </div>
                <h2 class="logo-text mb-2">
                    <span class="um">Um</span><span class="brella">brella</span>
                </h2>
                <p class="text-gray-300 text-lg mb-2">
                    Claims & Property Solutions
                </p>
                <div class="w-8 h-8 bg-red-500 rounded-full mx-auto mt-2"></div>
            </div>

            <!-- Login Form -->
            <div class="dark-card p-8">
                <h3 class="text-2xl font-bold text-white mb-6 text-center">
                    Umbrella CRM
                </h3>
                <p class="text-blue-400 text-center mb-6">
                    Professional Property Management
                </p>
                <div class="text-center text-white mb-6">
                    <span class="text-blue-400">•</span> Licensed <span class="text-blue-400">•</span> Insured <span class="text-blue-400">•</span> Trusted
                </div>
                
                <form id="loginForm" class="space-y-6">
                    <!-- Email Field -->
                    <div>
                        <label class="block text-sm font-medium text-white mb-2">
                            Email Address *
                        </label>
                        <input
                            type="email"
                            id="email"
                            required
                            class="input-field"
                            placeholder="Enter your email"
                        />
                    </div>

                    <!-- Password Field -->
                    <div>
                        <label class="block text-sm font-medium text-white mb-2">
                            Password *
                        </label>
                        <input
                            type="password"
                            id="password"
                            required
                            class="input-field"
                            placeholder="Enter your password"
                        />
                    </div>

                    <!-- Login Button -->
                    <button type="submit" class="btn-primary w-full">
                        Sign In to CRM
                    </button>
                </form>

                <!-- Demo Login -->
                <div class="mt-6 text-center">
                    <p class="text-sm text-gray-400 mb-2">Demo Access:</p>
                    <button onclick="demoLogin()" class="text-blue-400 hover:text-blue-300 text-sm">
                        Click here for demo access
                    </button>
                </div>
            </div>

            <!-- Company Info -->
            <div class="text-center text-gray-400">
                <p class="text-sm">141 Traction St, Greenville, SC 29611</p>
                <p class="text-sm">Phone: (864) 767-6188</p>
                <p class="text-sm">Email: customerscare@roofsbyumbrella.com</p>
                <p class="text-sm text-blue-400">www.roofsbyumbrella.com</p>
            </div>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div id="changePasswordModal" class="modal">
        <div class="modal-content">
            <h2 class="text-xl font-bold text-white mb-4">Change Password</h2>
            <p class="text-gray-300 mb-4">Please change your password for security.</p>
            <form id="changePasswordForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-white mb-2">Current Password</label>
                    <input type="password" id="currentPassword" class="input-field" required />
                </div>
                <div>
                    <label class="block text-sm font-medium text-white mb-2">New Password</label>
                    <input type="password" id="newPassword" class="input-field" required />
                </div>
                <div>
                    <label class="block text-sm font-medium text-white mb-2">Confirm New Password</label>
                    <input type="password" id="confirmPassword" class="input-field" required />
                </div>
                <div class="flex space-x-3">
                    <button type="submit" class="btn-primary flex-1">Change Password</button>
                    <button type="button" onclick="closeChangePasswordModal()" class="btn-secondary flex-1">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- CRM Interface -->
    <div id="crmInterface" class="crm-container h-screen bg-black">
        <!-- Header -->
        <header class="bg-black border-b border-gray-800 p-4">
            <div class="max-w-7xl mx-auto flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="flex items-center">
                        <img src="/logo-transparent.png" alt="Umbrella" class="h-12 mr-3" />
                        <div>
                            <h1 class="text-2xl font-bold">
                                <span class="text-blue-500">Um</span><span class="text-red-500">brella</span>
                            </h1>
                            <p class="text-gray-300 text-sm">Claims & Property Solutions</p>
                        </div>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-right text-gray-300">
                        <p class="text-sm">141 Traction St, Greenville, SC 29611</p>
                        <p class="text-sm">(864) 767-6188</p>
                        <p class="text-sm">customerscare@roofsbyumbrella.com</p>
                    </div>
                    <div class="flex items-center space-x-3">
                        <div class="text-right text-gray-300">
                            <p class="text-sm font-medium" id="userName">Loading...</p>
                            <p class="text-xs" id="userRole">Loading...</p>
                        </div>
                        <img id="userAvatar" src="/avatar-placeholder.png" alt="User" class="profile-avatar" />
                        <div class="relative">
                            <button onclick="toggleUserMenu()" class="text-blue-400 hover:text-blue-300 text-sm">▼</button>
                            <div id="userMenu" class="absolute right-0 mt-2 w-48 bg-gray-800 rounded-lg shadow-lg hidden">
                                <a href="#" onclick="showProfile()" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700">Profile</a>
                                <a href="#" onclick="showSettings()" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700">Settings</a>
                                <a href="#" onclick="changePassword()" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700">Change Password</a>
                                <hr class="border-gray-600">
                                <a href="#" onclick="logout()" class="block px-4 py-2 text-sm text-red-400 hover:bg-gray-700">Logout</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

                            <div class="flex h-full">
                        <!-- Sidebar -->
                        <nav class="sidebar-bg text-white w-64 p-6">
                            <div class="space-y-6">
                                <div class="text-center mb-8">
                                    <div class="flex items-center justify-center mb-4">
                                        <img src="/logo-transparent.png" alt="Umbrella" class="h-16" />
                                    </div>
                                    <h2 class="text-xl font-bold">Dashboard</h2>
                                </div>
                                
                                <div class="space-y-2">
                                    <div class="nav-link active p-3 rounded-lg transition-colors" onclick="showPage('dashboard')">
                                        📊 Dashboard
                                    </div>
                                    <div class="nav-link p-3 rounded-lg transition-colors" onclick="showPage('leads')">
                                        👥 Leads
                                    </div>
                                    <div class="nav-link p-3 rounded-lg transition-colors" onclick="showPage('jobs')">
                                        🏗️ Jobs
                                    </div>
                                    <div class="nav-link p-3 rounded-lg transition-colors" onclick="showPage('claims')">
                                        📋 Claims
                                    </div>
                                    <div class="nav-link p-3 rounded-lg transition-colors" onclick="showPage('contracts')">
                                        📄 Contracts
                                    </div>
                                    <div class="nav-link p-3 rounded-lg transition-colors" onclick="showPage('scheduling')">
                                        📅 Scheduling
                                    </div>
                                    <div class="nav-link p-3 rounded-lg transition-colors" onclick="showPage('photos')">
                                        📸 Photos
                                    </div>
                                    <div class="nav-link p-3 rounded-lg transition-colors" onclick="showPage('reports')">
                                        📈 Reports
                                    </div>
                                    <div class="nav-link p-3 rounded-lg transition-colors" onclick="showPage('customers')">
                                        👥 Customers
                                    </div>
                                    <div class="nav-link p-3 rounded-lg transition-colors" onclick="showPage('users')">
                                        👤 Users
                                    </div>
                                    <div class="nav-link p-3 rounded-lg transition-colors" onclick="showPage('integrations')">
                                        🔗 Integrations
                                    </div>
                                </div>
                            </div>
                        </nav>

                        <!-- Main Content -->
                        <main class="flex-1 p-8 overflow-auto">
                            <!-- Notes Panel -->
                            <div id="notesPanel" class="fixed right-0 top-0 h-full w-80 bg-gray-900 border-l border-gray-700 transform translate-x-full transition-transform duration-300 z-50">
                                <div class="p-4 border-b border-gray-700">
                                    <div class="flex items-center justify-between">
                                        <h3 class="text-lg font-bold text-white">📝 Activity & Notes</h3>
                                        <button onclick="toggleNotesPanel()" class="text-gray-400 hover:text-white">
                                            ✕
                                        </button>
                                    </div>
                                </div>
                                <div class="p-4 space-y-4 overflow-y-auto h-full">
                                    <!-- Activity Feed -->
                                    <div>
                                        <h4 class="text-sm font-semibold text-gray-300 mb-3">Recent Activity</h4>
                                        <div id="activityFeed" class="space-y-3">
                                            <!-- Activity items will be populated here -->
                                        </div>
                                    </div>
                                    
                                    <!-- Customer Notes -->
                                    <div>
                                        <h4 class="text-sm font-semibold text-gray-300 mb-3">Customer Notes</h4>
                                        <div id="customerNotes" class="space-y-3">
                                            <!-- Customer notes will be populated here -->
                                        </div>
                                    </div>
                                    
                                    <!-- Upcoming Appointments -->
                                    <div>
                                        <h4 class="text-sm font-semibold text-gray-300 mb-3">📅 Upcoming Appointments</h4>
                                        <div id="upcomingAppointments" class="space-y-3">
                                            <!-- Appointments will be populated here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Notes Toggle Button -->
                            <button id="notesToggle" onclick="toggleNotesPanel()" class="fixed right-4 top-20 bg-blue-600 text-white p-3 rounded-full shadow-lg z-40 hover:bg-blue-700 transition-colors">
                                📝
                            </button>
                <!-- Dashboard Page -->
                <div id="dashboard" class="page active space-y-6">
                    <h1 class="text-3xl font-bold text-white">Dashboard</h1>
                    
                    <!-- Stats Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="dark-card p-6">
                            <div class="flex items-center">
                                <div class="p-3 bg-blue-500 rounded-lg">
                                    <span class="text-white text-2xl">👥</span>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm text-gray-400">Total Leads</p>
                                    <p class="text-2xl font-bold text-white">24</p>
                                    <p class="text-sm text-green-400">+12% from last month</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="dark-card p-6">
                            <div class="flex items-center">
                                <div class="p-3 bg-green-500 rounded-lg">
                                    <span class="text-white text-2xl">🏗️</span>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm text-gray-400">Active Jobs</p>
                                    <p class="text-2xl font-bold text-white">8</p>
                                    <p class="text-sm text-green-400">+3% from last month</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="dark-card p-6">
                            <div class="flex items-center">
                                <div class="p-3 bg-purple-500 rounded-lg">
                                    <span class="text-white text-2xl">📅</span>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm text-gray-400">Scheduled</p>
                                    <p class="text-2xl font-bold text-white">12</p>
                                    <p class="text-sm text-green-400">+5% from last month</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="dark-card p-6">
                            <div class="flex items-center">
                                <div class="p-3 bg-yellow-500 rounded-lg">
                                    <span class="text-white text-2xl">💰</span>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm text-gray-400">Revenue</p>
                                    <p class="text-2xl font-bold text-white">$45,230</p>
                                    <p class="text-sm text-green-400">+18% from last month</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Charts Row -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="dark-card p-6">
                            <h3 class="text-lg font-bold text-white mb-4">Revenue Trend</h3>
                            <canvas id="revenueChart" width="400" height="200"></canvas>
                        </div>
                        <div class="dark-card p-6">
                            <h3 class="text-lg font-bold text-white mb-4">Lead Conversion</h3>
                            <canvas id="conversionChart" width="400" height="200"></canvas>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="dark-card p-6">
                        <h2 class="text-xl font-bold text-white mb-4">Recent Activity</h2>
                        <div class="space-y-4">
                            <div class="flex items-center p-3 bg-blue-900/20 rounded-lg">
                                <div class="w-2 h-2 bg-blue-500 rounded-full mr-3"></div>
                                <div class="flex-1">
                                    <p class="font-medium text-white">New lead added: John Smith</p>
                                    <p class="text-sm text-gray-400">2 minutes ago</p>
                                </div>
                            </div>
                            
                            <div class="flex items-center p-3 bg-yellow-900/20 rounded-lg">
                                <div class="w-2 h-2 bg-yellow-500 rounded-full mr-3"></div>
                                <div class="flex-1">
                                    <p class="font-medium text-white">Job #1234 moved to Production</p>
                                    <p class="text-sm text-gray-400">1 hour ago</p>
                                </div>
                            </div>
                            
                            <div class="flex items-center p-3 bg-green-900/20 rounded-lg">
                                <div class="w-2 h-2 bg-green-500 rounded-full mr-3"></div>
                                <div class="flex-1">
                                    <p class="font-medium text-white">Contract signed for 456 Oak St</p>
                                    <p class="text-sm text-gray-400">3 hours ago</p>
                                </div>
                            </div>
                            
                            <div class="flex items-center p-3 bg-green-900/20 rounded-lg">
                                <div class="w-2 h-2 bg-green-500 rounded-full mr-3"></div>
                                <div class="flex-1">
                                    <p class="font-medium text-white">Claim approved for $12,500</p>
                                    <p class="text-sm text-gray-400">5 hours ago</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="dark-card p-6">
                        <h2 class="text-xl font-bold text-white mb-4">Quick Actions</h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <button class="btn-primary text-center" onclick="showPage('leads')">
                                ➕ Add New Lead
                            </button>
                            <button class="btn-primary text-center" onclick="showPage('jobs')">
                                📋 Create Job
                            </button>
                            <button class="btn-primary text-center" onclick="showPage('contracts')">
                                📄 Generate Contract
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Customers Page -->
                <div id="customers" class="page space-y-6">
                    <div class="flex justify-between items-center">
                        <h1 class="text-3xl font-bold text-white">Customer Management</h1>
                        <button class="btn-primary" onclick="addNewCustomer()">➕ Add New Customer</button>
                    </div>
                    
                    <div class="dark-card p-6">
                        <div class="mb-4">
                            <input type="text" placeholder="Search customers..." class="input-field" id="customerSearch" onkeyup="searchCustomers()">
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="table-header">
                                        <th class="text-left p-3">Customer</th>
                                        <th class="text-left p-3">Phone</th>
                                        <th class="text-left p-3">Email</th>
                                        <th class="text-left p-3">Address</th>
                                        <th class="text-left p-3">Assigned To</th>
                                        <th class="text-left p-3">Status</th>
                                        <th class="text-left p-3">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="customersTable">
                                    <tr class="table-row">
                                        <td class="p-3">
                                            <div class="flex items-center">
                                                <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center mr-3">
                                                    <span class="text-white text-sm font-bold">JS</span>
                                                </div>
                                                <div>
                                                    <p class="text-white font-medium">John Smith</p>
                                                    <p class="text-sm text-gray-400">Customer #1001</p>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="p-3 text-gray-300">(555) 123-4567</td>
                                        <td class="p-3 text-gray-300">john@email.com</td>
                                        <td class="p-3 text-gray-300">123 Main St, Greenville, SC</td>
                                        <td class="p-3 text-gray-300">James Causey</td>
                                        <td class="p-3"><span class="bg-green-900 text-green-300 px-2 py-1 rounded">Active</span></td>
                                        <td class="p-3">
                                            <button class="text-blue-400 hover:text-blue-300 mr-2" onclick="viewCustomer(this)">View</button>
                                            <button class="text-green-400 hover:text-green-300 mr-2" onclick="addCustomerNote(this)">Notes</button>
                                            <button class="text-yellow-400 hover:text-yellow-300 mr-2" onclick="editCustomer(this)">Edit</button>
                                            <button class="text-red-400 hover:text-red-300" onclick="deleteCustomer(this)">Delete</button>
                                        </td>
                                    </tr>
                                    <tr class="table-row">
                                        <td class="p-3">
                                            <div class="flex items-center">
                                                <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center mr-3">
                                                    <span class="text-white text-sm font-bold">MJ</span>
                                                </div>
                                                <div>
                                                    <p class="text-white font-medium">Mary Johnson</p>
                                                    <p class="text-sm text-gray-400">Customer #1002</p>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="p-3 text-gray-300">(555) 987-6543</td>
                                        <td class="p-3 text-gray-300">mary@email.com</td>
                                        <td class="p-3 text-gray-300">456 Oak Ave, Greenville, SC</td>
                                        <td class="p-3 text-gray-300">Daniel Pruiksma</td>
                                        <td class="p-3"><span class="bg-blue-900 text-blue-300 px-2 py-1 rounded">Pending</span></td>
                                        <td class="p-3">
                                            <button class="text-blue-400 hover:text-blue-300 mr-2" onclick="viewCustomer(this)">View</button>
                                            <button class="text-green-400 hover:text-green-300 mr-2" onclick="addCustomerNote(this)">Notes</button>
                                            <button class="text-yellow-400 hover:text-yellow-300 mr-2" onclick="editCustomer(this)">Edit</button>
                                            <button class="text-red-400 hover:text-red-300" onclick="deleteCustomer(this)">Delete</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Users Page -->
                <div id="users" class="page space-y-6">
                    <div class="flex justify-between items-center">
                        <h1 class="text-3xl font-bold text-white">User Management</h1>
                        <button class="btn-primary" onclick="addNewUser()" id="addUserBtn" style="display: none;">➕ Add New User</button>
                    </div>
                    
                    <div class="dark-card p-6">
                        <div class="mb-4">
                            <input type="text" placeholder="Search users..." class="input-field" id="userSearch" onkeyup="searchUsers()">
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="table-header">
                                        <th class="text-left p-3">User</th>
                                        <th class="text-left p-3">Email</th>
                                        <th class="text-left p-3">Role</th>
                                        <th class="text-left p-3">Status</th>
                                        <th class="text-left p-3">Last Login</th>
                                        <th class="text-left p-3">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTable">
                                    <tr class="table-row">
                                        <td class="p-3">
                                            <div class="flex items-center">
                                                <img src="/avatar-james.png" alt="James" class="profile-avatar mr-3" />
                                                <div>
                                                    <p class="text-white font-medium">James Causey</p>
                                                    <p class="text-sm text-gray-400">Administrator</p>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="p-3 text-gray-300">james@roofsbyumbrella.com</td>
                                        <td class="p-3"><span class="bg-purple-900 text-purple-300 px-2 py-1 rounded">Administrator</span></td>
                                        <td class="p-3"><span class="bg-green-900 text-green-300 px-2 py-1 rounded">Active</span></td>
                                        <td class="p-3 text-gray-300">Just now</td>
                                        <td class="p-3">
                                            <button class="text-blue-400 hover:text-blue-300 mr-2" onclick="editUser(this)">Edit</button>
                                            <button class="text-yellow-400 hover:text-yellow-300 mr-2" onclick="resetPassword(this)">Reset</button>
                                            <button class="text-red-400 hover:text-red-300" onclick="deleteUser(this)">Delete</button>
                                        </td>
                                    </tr>
                                    <tr class="table-row">
                                        <td class="p-3">
                                            <div class="flex items-center">
                                                <img src="/avatar-daniel.png" alt="Daniel" class="profile-avatar mr-3" />
                                                <div>
                                                    <p class="text-white font-medium">Daniel Pruiksma</p>
                                                    <p class="text-sm text-gray-400">Administrator</p>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="p-3 text-gray-300">daniel@roofsbyumbrella.com</td>
                                        <td class="p-3"><span class="bg-purple-900 text-purple-300 px-2 py-1 rounded">Administrator</span></td>
                                        <td class="p-3"><span class="bg-green-900 text-green-300 px-2 py-1 rounded">Active</span></td>
                                        <td class="p-3 text-gray-300">2 hours ago</td>
                                        <td class="p-3">
                                            <button class="text-blue-400 hover:text-blue-300 mr-2" onclick="editUser(this)">Edit</button>
                                            <button class="text-yellow-400 hover:text-yellow-300 mr-2" onclick="resetPassword(this)">Reset</button>
                                            <button class="text-red-400 hover:text-red-300" onclick="deleteUser(this)">Delete</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Integrations Page -->
                <div id="integrations" class="page space-y-6">
                    <h1 class="text-3xl font-bold text-white">Integrations</h1>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="dark-card p-6">
                            <div class="flex items-center mb-4">
                                <div class="w-12 h-12 bg-blue-500 rounded-lg flex items-center justify-center mr-4">
                                    <span class="text-white text-xl">📅</span>
                                </div>
                                <div>
                                    <h3 class="text-lg font-bold text-white">Google Calendar</h3>
                                    <p class="text-sm text-gray-400">Sync appointments</p>
                                </div>
                            </div>
                            <p class="text-gray-300 mb-4">Connect your Google Calendar to automatically sync appointments and schedules.</p>
                            <button class="btn-primary w-full">Connect</button>
                        </div>
                        
                        <div class="dark-card p-6">
                            <div class="flex items-center mb-4">
                                <div class="w-12 h-12 bg-green-500 rounded-lg flex items-center justify-center mr-4">
                                    <span class="text-white text-xl">📧</span>
                                </div>
                                <div>
                                    <h3 class="text-lg font-bold text-white">Gmail</h3>
                                    <p class="text-sm text-gray-400">Email integration</p>
                                </div>
                            </div>
                            <p class="text-gray-300 mb-4">Connect Gmail to send emails directly from the CRM.</p>
                            <button class="btn-primary w-full">Connect</button>
                        </div>
                        
                        <div class="dark-card p-6">
                            <div class="flex items-center mb-4">
                                <div class="w-12 h-12 bg-purple-500 rounded-lg flex items-center justify-center mr-4">
                                    <span class="text-white text-xl">☁️</span>
                                </div>
                                <div>
                                    <h3 class="text-lg font-bold text-white">Google Drive</h3>
                                    <p class="text-sm text-gray-400">Document storage</p>
                                </div>
                            </div>
                            <p class="text-gray-300 mb-4">Connect Google Drive to store and manage documents.</p>
                            <button class="btn-primary w-full">Connect</button>
                        </div>
                        
                        <div class="dark-card p-6">
                            <div class="flex items-center mb-4">
                                <div class="w-12 h-12 bg-red-500 rounded-lg flex items-center justify-center mr-4">
                                    <span class="text-white text-xl">💳</span>
                                </div>
                                <div>
                                    <h3 class="text-lg font-bold text-white">Stripe</h3>
                                    <p class="text-sm text-gray-400">Payment processing</p>
                                </div>
                            </div>
                            <p class="text-gray-300 mb-4">Connect Stripe to process payments and invoices.</p>
                            <button class="btn-primary w-full">Connect</button>
                        </div>
                        
                        <div class="dark-card p-6">
                            <div class="flex items-center mb-4">
                                <div class="w-12 h-12 bg-yellow-500 rounded-lg flex items-center justify-center mr-4">
                                    <span class="text-white text-xl">📱</span>
                                </div>
                                <div>
                                    <h3 class="text-lg font-bold text-white">SMS Gateway</h3>
                                    <p class="text-sm text-gray-400">Text messaging</p>
                                </div>
                            </div>
                            <p class="text-gray-300 mb-4">Connect SMS gateway to send text messages to customers.</p>
                            <button class="btn-primary w-full">Connect</button>
                        </div>
                        
                        <div class="dark-card p-6">
                            <div class="flex items-center mb-4">
                                <div class="w-12 h-12 bg-indigo-500 rounded-lg flex items-center justify-center mr-4">
                                    <span class="text-white text-xl">📊</span>
                                </div>
                                <div>
                                    <h3 class="text-lg font-bold text-white">Analytics</h3>
                                    <p class="text-sm text-gray-400">Google Analytics</p>
                                </div>
                            </div>
                            <p class="text-gray-300 mb-4">Connect Google Analytics to track website performance.</p>
                            <button class="btn-primary w-full">Connect</button>
                        </div>
                    </div>
                </div>

                <!-- Leads Page -->
                <div id="leads" class="page space-y-6">
                    <div class="flex justify-between items-center">
                        <h1 class="text-3xl font-bold text-white">Leads Management</h1>
                        <button class="btn-primary" onclick="addNewLead()">➕ Add New Lead</button>
                    </div>
                    
                    <div class="dark-card p-6">
                        <div class="mb-4">
                            <input type="text" placeholder="Search leads..." class="input-field" id="leadSearch" onkeyup="searchLeads()">
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="table-header">
                                        <th class="text-left p-3">Name</th>
                                        <th class="text-left p-3">Phone</th>
                                        <th class="text-left p-3">Email</th>
                                        <th class="text-left p-3">Status</th>
                                        <th class="text-left p-3">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="leadsTable">
                                    <tr class="table-row">
                                        <td class="p-3 text-white">John Smith</td>
                                        <td class="p-3 text-gray-300">(555) 123-4567</td>
                                        <td class="p-3 text-gray-300">john@email.com</td>
                                        <td class="p-3"><span class="bg-blue-900 text-blue-300 px-2 py-1 rounded">New</span></td>
                                        <td class="p-3">
                                            <button class="text-blue-400 hover:text-blue-300 mr-2" onclick="editLead(this)">Edit</button>
                                            <button class="text-red-400 hover:text-red-300" onclick="deleteLead(this)">Delete</button>
                                        </td>
                                    </tr>
                                    <tr class="table-row">
                                        <td class="p-3 text-white">Sarah Wilson</td>
                                        <td class="p-3 text-gray-300">(555) 987-6543</td>
                                        <td class="p-3 text-gray-300">sarah@email.com</td>
                                        <td class="p-3"><span class="bg-green-900 text-green-300 px-2 py-1 rounded">Contacted</span></td>
                                        <td class="p-3">
                                            <button class="text-blue-400 hover:text-blue-300 mr-2" onclick="editLead(this)">Edit</button>
                                            <button class="text-red-400 hover:text-red-300" onclick="deleteLead(this)">Delete</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Jobs Page -->
                <div id="jobs" class="page space-y-6">
                    <div class="flex justify-between items-center">
                        <h1 class="text-3xl font-bold text-white">Jobs Management</h1>
                        <button class="btn-primary" onclick="addNewJob()">➕ Add New Job</button>
                    </div>
                    
                    <div class="dark-card p-6">
                        <div class="mb-4">
                            <input type="text" placeholder="Search jobs..." class="input-field" id="jobSearch" onkeyup="searchJobs()">
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="table-header">
                                        <th class="text-left p-3">Job #</th>
                                        <th class="text-left p-3">Customer</th>
                                        <th class="text-left p-3">Address</th>
                                        <th class="text-left p-3">Status</th>
                                        <th class="text-left p-3">Value</th>
                                        <th class="text-left p-3">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="jobsTable">
                                    <tr class="table-row">
                                        <td class="p-3 text-white">JOB-001</td>
                                        <td class="p-3 text-gray-300">John Smith</td>
                                        <td class="p-3 text-gray-300">123 Main St</td>
                                        <td class="p-3"><span class="bg-yellow-900 text-yellow-300 px-2 py-1 rounded">Inspection</span></td>
                                        <td class="p-3 text-gray-300">$15,000</td>
                                        <td class="p-3">
                                            <button class="text-blue-400 hover:text-blue-300 mr-2" onclick="editJob(this)">Edit</button>
                                            <button class="text-red-400 hover:text-red-300" onclick="deleteJob(this)">Delete</button>
                                        </td>
                                    </tr>
                                    <tr class="table-row">
                                        <td class="p-3 text-white">JOB-002</td>
                                        <td class="p-3 text-gray-300">Sarah Wilson</td>
                                        <td class="p-3 text-gray-300">456 Oak Ave</td>
                                        <td class="p-3"><span class="bg-green-900 text-green-300 px-2 py-1 rounded">Production</span></td>
                                        <td class="p-3 text-gray-300">$8,500</td>
                                        <td class="p-3">
                                            <button class="text-blue-400 hover:text-blue-300 mr-2" onclick="editJob(this)">Edit</button>
                                            <button class="text-red-400 hover:text-red-300" onclick="deleteJob(this)">Delete</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Claims Page -->
                <div id="claims" class="page space-y-6">
                    <div class="flex justify-between items-center">
                        <h1 class="text-3xl font-bold text-white">Insurance Claims</h1>
                        <button class="btn-primary" onclick="addNewClaim()">➕ Add New Claim</button>
                    </div>
                    
                    <div class="dark-card p-6">
                        <div class="mb-4">
                            <input type="text" placeholder="Search claims..." class="input-field" id="claimSearch" onkeyup="searchClaims()">
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="table-header">
                                        <th class="text-left p-3">Claim #</th>
                                        <th class="text-left p-3">Customer</th>
                                        <th class="text-left p-3">Insurance</th>
                                        <th class="text-left p-3">Status</th>
                                        <th class="text-left p-3">Value</th>
                                        <th class="text-left p-3">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="claimsTable">
                                    <tr class="table-row">
                                        <td class="p-3 text-white">CLM-001</td>
                                        <td class="p-3 text-gray-300">John Smith</td>
                                        <td class="p-3 text-gray-300">State Farm</td>
                                        <td class="p-3"><span class="bg-green-900 text-green-300 px-2 py-1 rounded">Approved</span></td>
                                        <td class="p-3 text-gray-300">$12,000</td>
                                        <td class="p-3">
                                            <button class="text-blue-400 hover:text-blue-300 mr-2" onclick="editClaim(this)">Edit</button>
                                            <button class="text-red-400 hover:text-red-300" onclick="deleteClaim(this)">Delete</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Contracts Page -->
                <div id="contracts" class="page space-y-6">
                    <div class="flex justify-between items-center">
                        <h1 class="text-3xl font-bold text-white">Contracts</h1>
                        <button class="btn-primary" onclick="addNewContract()">➕ Add New Contract</button>
                    </div>
                    
                    <div class="dark-card p-6">
                        <div class="mb-4">
                            <input type="text" placeholder="Search contracts..." class="input-field" id="contractSearch" onkeyup="searchContracts()">
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="table-header">
                                        <th class="text-left p-3">Contract #</th>
                                        <th class="text-left p-3">Customer</th>
                                        <th class="text-left p-3">Job #</th>
                                        <th class="text-left p-3">Status</th>
                                        <th class="text-left p-3">Value</th>
                                        <th class="text-left p-3">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="contractsTable">
                                    <tr class="table-row">
                                        <td class="p-3 text-white">CON-001</td>
                                        <td class="p-3 text-gray-300">John Smith</td>
                                        <td class="p-3 text-gray-300">JOB-001</td>
                                        <td class="p-3"><span class="bg-green-900 text-green-300 px-2 py-1 rounded">Signed</span></td>
                                        <td class="p-3 text-gray-300">$15,000</td>
                                        <td class="p-3">
                                            <button class="text-blue-400 hover:text-blue-300 mr-2" onclick="editContract(this)">Edit</button>
                                            <button class="text-green-400 hover:text-green-300 mr-2" onclick="signContract(this)">Sign</button>
                                            <button class="text-red-400 hover:text-red-300" onclick="deleteContract(this)">Delete</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Scheduling Page -->
                <div id="scheduling" class="page space-y-6">
                    <div class="flex justify-between items-center">
                        <h1 class="text-3xl font-bold text-white">Scheduling</h1>
                        <button class="btn-primary" onclick="addNewSchedule()">➕ Add Schedule</button>
                    </div>
                    
                    <div class="dark-card p-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <div class="border border-gray-700 rounded-lg p-4">
                                <h3 class="font-bold mb-2 text-white">Today</h3>
                                <div class="space-y-2">
                                    <div class="bg-blue-900/20 p-3 rounded">
                                        <p class="font-medium text-white">JOB-001 - John Smith</p>
                                        <p class="text-sm text-gray-400">8:00 AM - Roof Replacement</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="border border-gray-700 rounded-lg p-4">
                                <h3 class="font-bold mb-2 text-white">Tomorrow</h3>
                                <div class="space-y-2">
                                    <div class="bg-green-900/20 p-3 rounded">
                                        <p class="font-medium text-white">JOB-002 - Sarah Wilson</p>
                                        <p class="text-sm text-gray-400">9:00 AM - Gutter Replacement</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="border border-gray-700 rounded-lg p-4">
                                <h3 class="font-bold mb-2 text-white">This Week</h3>
                                <div class="space-y-2">
                                    <div class="bg-yellow-900/20 p-3 rounded">
                                        <p class="font-medium text-white">JOB-003 - Mike Johnson</p>
                                        <p class="text-sm text-gray-400">Wednesday - Inspection</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Photos Page -->
                <div id="photos" class="page space-y-6">
                    <div class="flex justify-between items-center">
                        <h1 class="text-3xl font-bold text-white">Photo Documentation</h1>
                        <button class="btn-primary" onclick="uploadPhotos()">📸 Upload Photos</button>
                    </div>
                    
                    <div class="dark-card p-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <div class="border border-gray-700 rounded-lg p-4">
                                <div class="bg-gray-800 h-32 rounded mb-2 flex items-center justify-center">
                                    <span class="text-gray-500">📷</span>
                                </div>
                                <h3 class="font-medium text-white">JOB-001 - Before</h3>
                                <p class="text-sm text-gray-400">John Smith - 123 Main St</p>
                                <p class="text-sm text-gray-500">Jan 20, 2024</p>
                            </div>
                            
                            <div class="border border-gray-700 rounded-lg p-4">
                                <div class="bg-gray-800 h-32 rounded mb-2 flex items-center justify-center">
                                    <span class="text-gray-500">📷</span>
                                </div>
                                <h3 class="font-medium text-white">JOB-001 - After</h3>
                                <p class="text-sm text-gray-400">John Smith - 123 Main St</p>
                                <p class="text-sm text-gray-500">Jan 25, 2024</p>
                            </div>
                            
                            <div class="border border-gray-700 rounded-lg p-4">
                                <div class="bg-gray-800 h-32 rounded mb-2 flex items-center justify-center">
                                    <span class="text-gray-500">📷</span>
                                </div>
                                <h3 class="font-medium text-white">JOB-002 - Progress</h3>
                                <p class="text-sm text-gray-400">Sarah Wilson - 456 Oak Ave</p>
                                <p class="text-sm text-gray-500">Jan 26, 2024</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reports Page -->
                <div id="reports" class="page space-y-6">
                    <h1 class="text-3xl font-bold text-white">Reports & Analytics</h1>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="dark-card p-6">
                            <h3 class="font-bold mb-2 text-white">Monthly Revenue</h3>
                            <p class="text-3xl font-bold text-green-400">$45,230</p>
                            <p class="text-sm text-green-400">+18% from last month</p>
                        </div>
                        
                        <div class="dark-card p-6">
                            <h3 class="font-bold mb-2 text-white">Lead Conversion</h3>
                            <p class="text-3xl font-bold text-blue-400">23.5%</p>
                            <p class="text-sm text-blue-400">+2.1% from last month</p>
                        </div>
                        
                        <div class="dark-card p-6">
                            <h3 class="font-bold mb-2 text-white">Active Jobs</h3>
                            <p class="text-3xl font-bold text-purple-400">8</p>
                            <p class="text-sm text-purple-400">+3 from last month</p>
                        </div>
                        
                        <div class="dark-card p-6">
                            <h3 class="font-bold mb-2 text-white">Customer Satisfaction</h3>
                            <p class="text-3xl font-bold text-yellow-400">4.8/5</p>
                            <p class="text-sm text-yellow-400">+0.2 from last month</p>
                        </div>
                    </div>
                    
                    <div class="dark-card p-6">
                        <h2 class="text-xl font-bold text-white mb-4">Recent Reports</h2>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center p-3 bg-gray-800 rounded">
                                <div>
                                    <p class="font-medium text-white">Monthly Revenue Report</p>
                                    <p class="text-sm text-gray-400">January 2024</p>
                                </div>
                                <button class="btn-primary">Download</button>
                            </div>
                            
                            <div class="flex justify-between items-center p-3 bg-gray-800 rounded">
                                <div>
                                    <p class="font-medium text-white">Lead Analytics Report</p>
                                    <p class="text-sm text-gray-400">Q4 2023</p>
                                </div>
                                <button class="btn-primary">Download</button>
                            </div>
                            
                            <div class="flex justify-between items-center p-3 bg-gray-800 rounded">
                                <div>
                                    <p class="font-medium text-white">Job Performance Report</p>
                                    <p class="text-sm text-gray-400">December 2023</p>
                                </div>
                                <button class="btn-primary">Download</button>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        // User data with role-based permissions
        const users = {
            'james@roofsbyumbrella.com': {
                password: 'Welcome1234!',
                name: 'James Causey',
                role: 'Administrator',
                avatar: '/avatar-james.png',
                needsPasswordChange: true,
                permissions: ['all'] // Can see and do everything
            },
            'daniel@roofsbyumbrella.com': {
                password: 'Welcome1234!',
                name: 'Daniel Pruiksma',
                role: 'Administrator',
                avatar: '/avatar-daniel.png',
                needsPasswordChange: true,
                permissions: ['all'] // Can see and do everything
            }
        };

        // Sample data
        const customers = [
            {
                id: '1001',
                name: 'John Smith',
                phone: '(555) 123-4567',
                email: 'john@email.com',
                address: '123 Main St, Greenville, SC',
                assignedTo: 'James Causey',
                status: 'Active',
                notes: [
                    { user: 'James Causey', text: 'Initial contact made. Customer interested in roof inspection.', timestamp: '2024-01-15 10:30' },
                    { user: 'Daniel Pruiksma', text: 'Scheduled inspection for next week.', timestamp: '2024-01-16 14:20' }
                ]
            },
            {
                id: '1002',
                name: 'Mary Johnson',
                phone: '(555) 987-6543',
                email: 'mary@email.com',
                address: '456 Oak Ave, Greenville, SC',
                assignedTo: 'Daniel Pruiksma',
                status: 'Pending',
                notes: [
                    { user: 'Daniel Pruiksma', text: 'Customer called about storm damage.', timestamp: '2024-01-14 09:15' }
                ]
            }
        ];

        const appointments = [
            { customer: 'John Smith', date: '2024-01-20', time: '10:00 AM', type: 'Inspection', assignedTo: 'James Causey' },
            { customer: 'Mary Johnson', date: '2024-01-22', time: '2:00 PM', type: 'Follow-up', assignedTo: 'Daniel Pruiksma' }
        ];

        const activityLog = [
            { user: 'James Causey', action: 'Added new customer: John Smith', timestamp: '2024-01-15 10:30' },
            { user: 'Daniel Pruiksma', action: 'Updated job status for #1234', timestamp: '2024-01-16 14:20' },
            { user: 'James Causey', action: 'Scheduled inspection for John Smith', timestamp: '2024-01-16 15:45' },
            { user: 'Daniel Pruiksma', action: 'Added note to Mary Johnson', timestamp: '2024-01-14 09:15' }
        ];

        let currentUser = null;
        let isDemoMode = false;

        // Login functionality
        function demoLogin() {
            isDemoMode = true;
            currentUser = {
                name: 'Demo User',
                role: 'Demo',
                avatar: '/avatar-placeholder.png',
                needsPasswordChange: false
            };
            loginSuccess();
        }

        function loginSuccess() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('crmInterface').classList.add('active');
            
            // Update user info
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userRole').textContent = currentUser.role;
            document.getElementById('userAvatar').src = currentUser.avatar;
            
            // Apply role-based permissions
            applyRolePermissions();
            
            // Check if password change is needed
            if (currentUser.needsPasswordChange && !isDemoMode) {
                setTimeout(() => {
                    showChangePasswordModal();
                }, 1000);
            }
            
            // Initialize charts and notes
            initializeCharts();
            updateActivityFeed();
            updateCustomerNotes();
            updateUpcomingAppointments();
        }

        function applyRolePermissions() {
            const isAdmin = currentUser.role === 'Administrator';
            const isManager = currentUser.role === 'Manager';
            const isSalesRep = currentUser.role === 'Sales Rep';
            
            // Show/hide user management based on role
            const addUserBtn = document.getElementById('addUserBtn');
            if (addUserBtn) {
                addUserBtn.style.display = isAdmin ? 'block' : 'none';
            }
            
            // Filter data based on role
            if (isSalesRep) {
                // Sales reps can only see their own customers and jobs
                filterDataForSalesRep();
            } else if (isManager) {
                // Managers can see all customers and their own jobs
                filterDataForManager();
            }
            // Admins can see everything (no filtering needed)
        }

        function filterDataForSalesRep() {
            // Filter customers table to show only assigned customers
            const rows = document.querySelectorAll('#customersTable tr');
            rows.forEach(row => {
                const assignedTo = row.querySelector('td:nth-child(5)')?.textContent;
                if (assignedTo && assignedTo !== currentUser.name) {
                    row.style.display = 'none';
                }
            });
        }

        function filterDataForManager() {
            // Managers can see all customers but only their own jobs
            // This would be implemented when jobs page is added
        }

        function showChangePasswordModal() {
            document.getElementById('changePasswordModal').style.display = 'block';
        }

        function closeChangePasswordModal() {
            document.getElementById('changePasswordModal').style.display = 'none';
        }

        function toggleUserMenu() {
            const menu = document.getElementById('userMenu');
            menu.classList.toggle('hidden');
        }

        function toggleNotesPanel() {
            const panel = document.getElementById('notesPanel');
            const toggle = document.getElementById('notesToggle');
            
            if (panel.classList.contains('translate-x-full')) {
                panel.classList.remove('translate-x-full');
                toggle.textContent = '✕';
            } else {
                panel.classList.add('translate-x-full');
                toggle.textContent = '📝';
            }
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type === 'success' ? 'bg-green-600' : 'bg-red-600'}`;
            notification.style.display = 'block';
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        function updateActivityFeed() {
            const feed = document.getElementById('activityFeed');
            if (!feed) return;
            
            feed.innerHTML = '';
            activityLog.slice(0, 10).forEach(activity => {
                const activityItem = document.createElement('div');
                activityItem.className = 'p-3 bg-gray-800 rounded-lg';
                activityItem.innerHTML = `
                    <div class="flex items-start space-x-3">
                        <div class="w-2 h-2 bg-blue-500 rounded-full mt-2"></div>
                        <div class="flex-1">
                            <p class="text-sm text-white font-medium">${activity.user}</p>
                            <p class="text-xs text-gray-400">${activity.action}</p>
                            <p class="text-xs text-gray-500">${activity.timestamp}</p>
                        </div>
                    </div>
                `;
                feed.appendChild(activityItem);
            });
        }

        function updateCustomerNotes() {
            const notesContainer = document.getElementById('customerNotes');
            if (!notesContainer) return;
            
            notesContainer.innerHTML = '';
            customers.forEach(customer => {
                if (customer.notes && customer.notes.length > 0) {
                    const customerNote = document.createElement('div');
                    customerNote.className = 'p-3 bg-gray-800 rounded-lg mb-3';
                    customerNote.innerHTML = `
                        <div class="flex items-center justify-between mb-2">
                            <h5 class="text-sm font-medium text-white">${customer.name}</h5>
                            <span class="text-xs text-gray-400">${customer.notes.length} notes</span>
                        </div>
                        <div class="space-y-2">
                            ${customer.notes.map(note => `
                                <div class="text-xs text-gray-300">
                                    <span class="text-blue-400">${note.user}:</span> ${note.text}
                                    <div class="text-gray-500 text-xs mt-1">${note.timestamp}</div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    notesContainer.appendChild(customerNote);
                }
            });
        }

        function updateUpcomingAppointments() {
            const appointmentsContainer = document.getElementById('upcomingAppointments');
            if (!appointmentsContainer) return;
            
            appointmentsContainer.innerHTML = '';
            appointments.forEach(appointment => {
                const appointmentItem = document.createElement('div');
                appointmentItem.className = 'p-3 bg-gray-800 rounded-lg';
                appointmentItem.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-white">${appointment.customer}</p>
                            <p class="text-xs text-gray-400">${appointment.type}</p>
                            <p class="text-xs text-gray-500">${appointment.date} at ${appointment.time}</p>
                        </div>
                        <div class="text-right">
                            <p class="text-xs text-blue-400">${appointment.assignedTo}</p>
                        </div>
                    </div>
                `;
                appointmentsContainer.appendChild(appointmentItem);
            });
        }

        function initializeCharts() {
            // Revenue Chart
            const revenueCtx = document.getElementById('revenueChart').getContext('2d');
            new Chart(revenueCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Revenue',
                        data: [30000, 35000, 42000, 38000, 45000, 48000],
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#ffffff'
                            }
                        }
                    },
                    scales: {
                        y: {
                            ticks: {
                                color: '#ffffff'
                            },
                            grid: {
                                color: '#374151'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#ffffff'
                            },
                            grid: {
                                color: '#374151'
                            }
                        }
                    }
                }
            });

            // Conversion Chart
            const conversionCtx = document.getElementById('conversionChart').getContext('2d');
            new Chart(conversionCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Converted', 'In Progress', 'Lost'],
                    datasets: [{
                        data: [65, 25, 10],
                        backgroundColor: ['#10b981', '#f59e0b', '#ef4444']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#ffffff'
                            }
                        }
                    }
                }
            });
        }

        // Navigation functionality
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
            
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        // User management functions
        function addNewUser() {
            if (currentUser.role !== 'Administrator') {
                showNotification('Only administrators can add new users', 'error');
                return;
            }
            showNotification('Add user feature coming soon!');
        }

        function editUser(button) {
            if (currentUser.role !== 'Administrator') {
                showNotification('Only administrators can edit users', 'error');
                return;
            }
            showNotification('Edit user feature coming soon!');
        }

        function resetPassword(button) {
            if (currentUser.role !== 'Administrator') {
                showNotification('Only administrators can reset passwords', 'error');
                return;
            }
            showNotification('Password reset feature coming soon!');
        }

        function deleteUser(button) {
            if (currentUser.role !== 'Administrator') {
                showNotification('Only administrators can delete users', 'error');
                return;
            }
            if (confirm('Are you sure you want to delete this user?')) {
                button.closest('tr').remove();
                showNotification('User deleted successfully');
                addActivityLog(`${currentUser.name} deleted a user`);
            }
        }

        function searchUsers() {
            const searchTerm = document.getElementById('userSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#usersTable tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        // Customer management functions
        function addNewCustomer() {
            if (currentUser.role === 'Sales Rep') {
                showNotification('Sales reps can only input new jobs, not customers', 'error');
                return;
            }
            showNotification('Add customer feature coming soon!');
            addActivityLog(`${currentUser.name} added a new customer`);
        }

        function viewCustomer(button) {
            showNotification('View customer feature coming soon!');
        }

        function addCustomerNote(button) {
            const customerName = button.closest('tr').querySelector('td:first-child .text-white').textContent;
            const note = prompt(`Add a note for ${customerName}:`);
            if (note) {
                addActivityLog(`${currentUser.name} added a note to ${customerName}: ${note}`);
                showNotification('Note added successfully!');
                updateCustomerNotes();
            }
        }

        function editCustomer(button) {
            if (currentUser.role === 'Sales Rep') {
                showNotification('Sales reps cannot edit customers', 'error');
                return;
            }
            showNotification('Edit customer feature coming soon!');
            addActivityLog(`${currentUser.name} edited a customer`);
        }

        function deleteCustomer(button) {
            if (currentUser.role === 'Sales Rep') {
                showNotification('Sales reps cannot delete customers', 'error');
                return;
            }
            if (confirm('Are you sure you want to delete this customer?')) {
                button.closest('tr').remove();
                showNotification('Customer deleted successfully');
                addActivityLog(`${currentUser.name} deleted a customer`);
            }
        }

        function searchCustomers() {
            const searchTerm = document.getElementById('customerSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#customersTable tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        // Other functions
        function addNewLead() {
            if (currentUser.role === 'Sales Rep') {
                showNotification('Sales reps can only input new jobs', 'error');
                return;
            }
            showNotification('Add lead feature coming soon!');
            addActivityLog(`${currentUser.name} added a new lead`);
        }

        function editLead(button) {
            if (currentUser.role === 'Sales Rep') {
                showNotification('Sales reps can only input new jobs', 'error');
                return;
            }
            showNotification('Edit lead feature coming soon!');
            addActivityLog(`${currentUser.name} edited a lead`);
        }

        function deleteLead(button) {
            if (currentUser.role === 'Sales Rep') {
                showNotification('Sales reps can only input new jobs', 'error');
                return;
            }
            if (confirm('Are you sure you want to delete this lead?')) {
                button.closest('tr').remove();
                showNotification('Lead deleted successfully');
                addActivityLog(`${currentUser.name} deleted a lead`);
            }
        }

        function searchLeads() {
            const searchTerm = document.getElementById('leadSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#leadsTable tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        function addActivityLog(action) {
            const timestamp = new Date().toLocaleString();
            activityLog.unshift({ user: currentUser.name, action: action, timestamp: timestamp });
            updateActivityFeed();
        }

        function showProfile() {
            showNotification('Profile page coming soon!');
        }

        function showSettings() {
            showNotification('Settings page coming soon!');
        }

        function changePassword() {
            showChangePasswordModal();
        }

        function logout() {
            currentUser = null;
            isDemoMode = false;
            document.getElementById('loginPage').style.display = 'block';
            document.getElementById('crmInterface').classList.remove('active');
            document.getElementById('loginForm').reset();
        }

        // Login form submission
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (users[email] && users[email].password === password) {
                currentUser = users[email];
                loginSuccess();
                showNotification('Login successful!');
            } else {
                showNotification('Invalid email or password', 'error');
            }
        });

        // Change password form
        document.getElementById('changePasswordForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (currentPassword !== currentUser.password) {
                showNotification('Current password is incorrect', 'error');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showNotification('New passwords do not match', 'error');
                return;
            }
            
            if (newPassword.length < 8) {
                showNotification('Password must be at least 8 characters', 'error');
                return;
            }
            
            // Update password
            currentUser.password = newPassword;
            currentUser.needsPasswordChange = false;
            
            closeChangePasswordModal();
            showNotification('Password changed successfully!');
        });

        // Close modals when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('changePasswordModal');
            if (event.target === modal) {
                closeChangePasswordModal();
            }
        }
    </script>
</body>
</html> 